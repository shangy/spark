ying's rewrite of spark
